<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meine Datentabelle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .filter-container {
            margin-bottom: 20px;
        }

        .filter-container label,
        .filter-container input {
            margin-right: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th {
            height: 50px;
            background-color: #f2f2f2;
            color: #333;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .hidden {
            display: none;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #333;
            color: #fff;
        }

        .container {
            display: flex;
        }

        .sidebar {
            width: 200px;
            background: #444;
            /* Dunkler Hintergrund für die Sidebar */
            padding: 20px;
            /*height: 75vh;*/
            /* Vollständige Höhe */
            box-sizing: border-box;
            /* Padding in die Breite einschließen */
            margin-bottom: 50px;
            /* oder die Höhe Ihres Footers */
        }

        .main-content {
            flex-grow: 1;
            background: #555;
            /* Hintergrund für den Hauptinhalt */
            padding: 20px;
            /*height: 75vh;*/
            width: 100vw;
            box-sizing: border-box;
            margin-bottom: 50px;
            /* oder die Höhe Ihres Footers */
        }

        .checkbox-list {
            list-style: none;
            padding-left: 0;
        }

        .checkbox-list li {
            padding-bottom: 10px;
        }


        body {
            font-family: Arial, sans-serif;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .number-input {
            width: calc(100% - 40px);
            padding: 10px;
            font-size: 18px;
            margin: 0 auto;
            display: block;
            box-sizing: border-box;
        }

        .button-container {
            text-align: center;
            margin-top: 10px;
        }

        .confirm-button,
        .download-button,
        .load-button,
        .file-input {
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }

        .confirm-button {
            background-color: #4CAF50;
            color: white;
        }

        .download-button {
            background-color: #008CBA;
            color: white;
        }

        .load-button {
            background-color: #f44336;
            color: white;
        }

        .file-input {
            background-color: #4936f4;
            color: white;
        }

        body {
            font-family: Arial, sans-serif;
        }


        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }



        .label-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 5px;
            /* Equal spacing */
            max-width: 65%;
            margin: 0 auto;
            background-color: green;
            border-radius: 15px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .label {
            flex: 1;
            text-align: center;
        }

        .containers {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 10vh;
        }

        .content {
            text-align: center;
        }

        .pp {
            margin-right: 10px;
        }

        .input1 {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .input2 {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <ul class="checkbox-list">
                <li>
                    <input type="checkbox" id="checkbox1" name="checkbox1">
                    <label for="checkbox1">Infos</label>
                </li>
                <li>
                    <input type="checkbox" id="checkbox4" name="checkbox4">
                    <label for="checkbox4">Data upload</label>
                </li>
                <li>
                    <input type="checkbox" id="checkbox7" name="checkbox7">
                    <label for="checkbox7">Such feld</label>
                </li>
                <li>
                    <input type="checkbox" id="checkbox2" name="checkbox2">
                    <label for="checkbox2">Option 2</label>
                </li>
                <li>
                    <input type="checkbox" id="checkbox3" name="checkbox3">
                    <label for="checkbox3">Option 3</label>
                </li>
                <li>
                    <input type="checkbox" id="checkbox5" name="checkbox5">
                    <label for="checkbox5">Option 5</label>
                </li>
                <li>
                    <input type="checkbox" id="checkbox6" name="checkbox6">
                    <label for="checkbox6">Option 6</label>
                </li>

                <li>
                    <input type="checkbox" id="checkbox8" name="checkbox8">
                    <label for="checkbox8">Option 8</label>
                </li>
                <!-- Weitere Checkboxen nach Bedarf hinzufügen -->
            </ul>
        </div>
        <div class="main-content">
            <div id="div1" style="display: none;">
                <p>Infos zu Kessel: z.B 2.70% = Durchschnitt wie oft sein sollte</p>
            </div>
            <div id="div4" style="display: none;">
                <textarea id="number-input" class="number-input" rows="5"
                    placeholder="Enter numbers separated by spaces"></textarea>
                <div class="button-container">
                    <button id="confirm-button" class="confirm-button">Save</button>
                    <button id="download-button" class="download-button">Download</button>
                    <button id="load-button" class="load-button">Load JSON File</button>
                    <!-- Use an input type="file" for loading images -->
                    <input type="file" id="file-input" accept="image/*" style="display: none;">
                    <label for="file-input" class="file-input">Load Image</label>
                </div>
            </div>
            <div id="div7" style="display: none;">
                <div class="filter-container">
                    <label for="search">Suche:</label>
                    <input type="text" id="search"
                        onkeyup="searchTableInMultipleTables(['meineTabelle', 'meineTabelle2'], 0)"
                        placeholder="Überall suchen...">

                </div>
            </div>
            <div id="div2" style="display: none;">
                <table id="meineTabelle" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Distanz</th>
                            <th class="hidden">Anzahl</th>
                            <th onclick="sortTable('meineTabelle',1)">Prozentsatz &#x25B2;&#x25BC;</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Die Zellen werden durch das Skript hinzugefügt -->
                    </tbody>
                </table>
            </div>
            <div id="div3" style="display: none;">
                <table id="meineTabelle2" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Nummer</th>
                            <th class="hidden">Anzahl</th>
                            <th onclick="sortTable('meineTabelle2',1)">Prozentsatz &#x25B2;&#x25BC;</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Die Zellen werden durch das Skript hinzugefügt -->
                    </tbody>
                </table>
            </div>
            <div id="div5" style="display: none;">
                <div class="containers">
                    <div class="content">
                        <input type="text" id="input1">
                        <input type="text" id="input2">
                        <label id="pp" for="input1">Label:</label>
                    </div>
                </div>
            </div>
            <div id="div6" style="display: none;">
                <div id="main-container"></div>
            </div>

            <div id="div8" style="display: none;">
                <p>Infos zu Kessel: z.B 2.70% = Durchschnitt wie oft sein sollte</p>
            </div>
        </div>
    </div>

    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script>
        // Global Variables
        let f = 0;
        const input1 = document.getElementById('input1');
        const input2 = document.getElementById('input2');
        var rouletteOrder = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];

        // einfach generierte Testdaten
        // var numbers = [];
        // for (var i = 0; i < 500; i++) {
        //     numbers.push(Math.floor(Math.random() * 37));
        // }

        document.addEventListener('DOMContentLoaded', function() {
            var maininput = document.getElementById('number-input').value.split(',');
            console.log(maininput);
            console.log(calculateDistances(maininput));
            erstellenTabelle(maininput);
        });

        // Input Load Image
        document.getElementById('file-input').addEventListener('change', function (event) {
            var files = event.target.files;
            if (files.length > 0) {
                var file = files[0];
                if (file.type.startsWith('image/')) {
                    console.log('Image selected:', file.name);
                    var reader = new FileReader();
                    reader.onload = function (event) {
                        var imageData = event.target.result;
                        Tesseract.recognize(imageData, "eng", {})
                            .then(out => {
                                var output = out.data.text;
                                console.log(output);
                                var textarea = document.getElementById('number-input');
                                textarea.value += output;
                            })
                            .catch(err => {
                                console.error('Error recognizing text:', err);
                            });
                    };
                    reader.readAsDataURL(file);
                } else {
                    console.log('File is not an image:', file.name);
                }
            }
        });



        //Wahrscheindlich unnötig
        input2.addEventListener('input', function (event) {
            let nextNumberIndex = rouletteOrder.indexOf(parseInt(input1.value));
            console.log(nextNumberIndex);
            if (nextNumberIndex + parseInt(input2.value) <= 36) {
                f = (nextNumberIndex + parseInt(input2.value));
            }
            if (nextNumberIndex + parseInt(input2.value) > 36) {
                f = nextNumberIndex + parseInt(input2.value) - 37;

            }
            const pp = document.getElementById('pp');
            let ff = rouletteOrder[f];
            pp.innerHTML = ff.toString();
        });
        const iterations = 37;
        const mainContainer = document.getElementById('main-container');
        for (let i = 0; i < iterations; i++) {
            const labelContainer = document.createElement('div');
            labelContainer.classList.add('label-container');
            for (let j = 0; j < 4; j++) {
                const label = document.createElement('label');
                label.textContent = ``;
                label.classList.add('label', j % 2 === 0 ? 'left' : 'right');
                labelContainer.appendChild(label);
            }
            mainContainer.appendChild(labelContainer);
        }

        // Function to calculate neighbors
        function calculateNeighbors(numbersArray) {
            const neighbors = {};
            let bool = true;
            let A = [];
            let B = [];
            let Neighbors = 0;
            for (let i = 0; i < numbersArray.length - 1; i++) {
                const number = numbersArray[i + 1];
                const prevnumber = numbersArray[i];
                console.log("Number:", number);
                console.log("Previous Number:", prevnumber);
                let nextNumberIndex = rouletteOrder.indexOf(parseInt(number));
                let prevNumberIndex = rouletteOrder.indexOf(parseInt(prevnumber));
                console.log("Position of next number:", nextNumberIndex);
                console.log("Position of previous number:", prevNumberIndex);
                if (prevnumber === 'f') {
                    bool = true;
                } if (prevnumber === 'b') {
                    bool = false;
                }
                if (bool && prevnumber !== 'x' && prevnumber !== 'f' && prevnumber !== 'b' && number !== 'x' && number !== 'f' && number !== 'b') {
                    let f = 0;
                    if (nextNumberIndex - prevNumberIndex > 0) { f = nextNumberIndex - prevNumberIndex }
                    if (nextNumberIndex - prevNumberIndex < 0) { f = 37 + (nextNumberIndex - prevNumberIndex) }
                    A.push(f);
                    console.log("Gezählte Nachbarn F:", f);
                }
                if (!bool && prevnumber !== 'x' && prevnumber !== 'f' && prevnumber !== 'b' && number !== 'x' && number !== 'f' && number !== 'b') {
                    let b = 0;
                    if (nextNumberIndex - prevNumberIndex > 0) { b = nextNumberIndex - prevNumberIndex }
                    if (nextNumberIndex - prevNumberIndex < 0) { b = 37 + (nextNumberIndex - prevNumberIndex) }

                    B.push(b);
                    console.log("Gezählte Nachbarn B:", b);

                }

            }
            console.log("Array A:", A);
            console.log("Array B:", B);
            return [A, B];
        }

        //Speichern Button
        document.getElementById('confirm-button').addEventListener('click', function () {
            const numbersInput = document.getElementById('number-input').value.trim();
            const numbersArray = numbersInput.split(/[ ,\n]+/).filter(num => !isNaN(num) || num === 'x' || num === 'f' || num === 'b');
            console.log("Hier:" + numbersArray);
            erstellenTabelle(numbersArray);
            const [A, B] = calculateNeighbors(numbersArray);
            const sortedA = calculatePercentage(A);
            const sortedB = calculatePercentage(B);
            function calculatePercentage(array) {
                const percentages = {};
                const length = array.length;
                array.forEach(number => {
                    percentages[number] = (percentages[number] || 0) + (1 / length * 100);
                });
                const sortedPercentages = Object.entries(percentages).sort((a, b) => b[1] - a[1]);
                const result = sortedPercentages.map(entry => {
                    return {
                        count: entry[1] / 100 * length,
                        number: parseInt(entry[0]),
                        percentage: entry[1]
                    };
                });
                return result;
            }

            //Ausgabe Liste -> grün -> sollte wahrscheindlich unter gobalen variabeln oder Function
            for (let i = 1; i <= 37; i++) {
                const AElement = sortedA[i - 1] || { count: "", number: "", percentage: "" };
                const cA = AElement.count !== null && AElement.count !== undefined && AElement.count !== "" ? Math.round(AElement.count) : "";
                const nA = AElement.number !== null && AElement.number !== undefined ? AElement.number.toString() : "";
                const pA = AElement.percentage !== null && AElement.percentage !== undefined && !isNaN(parseFloat(AElement.percentage)) ? parseFloat(AElement.percentage).toFixed(3) : "";

                const BElement = sortedB[i - 1] || { count: "", number: "", percentage: "" };

                const cB = BElement.count !== null && BElement.count !== undefined && BElement.count !== "" ? Math.round(BElement.count) : "";
                const nB = BElement.number !== null && BElement.number !== undefined ? BElement.number.toString() : "";
                const pB = BElement.percentage !== null && BElement.percentage !== undefined && !isNaN(parseFloat(BElement.percentage)) ? parseFloat(BElement.percentage).toFixed(3) : "";

                const percentageTextA = pA ? " (" + pA + "%)" : "";
                const percentageTextB = pB ? " (" + pB + "%)" : "";

                document.querySelector(`.label-container:nth-child(${i}) label:nth-child(1)`).textContent = nA;
                document.querySelector(`.label-container:nth-child(${i}) label:nth-child(2)`).textContent = cA + percentageTextA;
                document.querySelector(`.label-container:nth-child(${i}) label:nth-child(3)`).textContent = nB;
                document.querySelector(`.label-container:nth-child(${i}) label:nth-child(4)`).textContent = cB + percentageTextB;
            }
        });

        document.getElementById('download-button').addEventListener('click', function () {

        });

        //Download Button
        //   document.getElementById('load-button').addEventListener('click', function() {
        //     document.getElementById('file-input').click();
        //   });

        //   document.getElementById('file-input').addEventListener('change', function(event) {
        //     const file = event.target.files[0];
        //     const reader = new FileReader();
        //     reader.onload = function(e) {
        //       const content = e.target.result;
        //       try {
        //         const parsedData = JSON.parse(content);
        //         if (parsedData && parsedData.numbers && Array.isArray(parsedData.numbers)) {
        //           document.getElementById('number-input').value = parsedData.numbers.join(' ');
        //         } else {
        //           alert('Invalid JSON format. Please select a valid JSON file.');
        //         }
        //       } catch (error) {
        //         alert('Error parsing JSON. Please select a valid JSON file.');
        //       }
        //     };
        //     reader.readAsText(file);
        //   });

        //Logik Suchfeld
        function searchTableInMultipleTables(tableIds, columnIndex) {
            var input, filter, i, j, table, tr, td, txtValue;
            input = document.getElementById("search");
            filter = input.value.toUpperCase();
            tableIds.forEach(function (tableId) {
                table = document.getElementById(tableId);
                tr = table.getElementsByTagName("tr");

                for (i = 1; i < tr.length; i++) {
                    td = tr[i].getElementsByTagName("td")[columnIndex];
                    if (td) {
                        txtValue = td.textContent || td.innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                        } else {
                            tr[i].style.display = "none";
                        }
                    }
                }
            });
        }


        //Logik Sortieren
        function sortTable(tableId, n) {
            var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
            table = document.getElementById(tableId);
            switching = true;
            dir = "asc";
            while (switching) {
                switching = false;
                rows = table.rows;
                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];
                    if (dir == "asc") {
                        if (parseFloat(x.innerHTML.replace('%', '')) > parseFloat(y.innerHTML.replace('%', ''))) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir == "desc") {
                        if (parseFloat(x.innerHTML.replace('%', '')) < parseFloat(y.innerHTML.replace('%', ''))) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }

        //Schaut in in arr für jede zahl welche zahl wie viel mal als nächstes gekommen ist
        function calculateProbabilities(numbers) {
            var probabilities = {};
            for (var i = 0; i < numbers.length - 1; i++) {
                var currentNumber = numbers[i];
                var nextNumber = numbers[i + 1];
                if (!probabilities[currentNumber]) {
                    probabilities[currentNumber] = {};
                }
                if (!probabilities[currentNumber][nextNumber]) {
                    probabilities[currentNumber][nextNumber] = 0;
                }
                probabilities[currentNumber][nextNumber]++;
            }
            return probabilities;
        }

        //Zählt wie oft eine Zahl vorkommt
        function countOccurrences(numbers) {
            var occurrences = {};
            for (var i = 0; i < numbers.length; i++) {
                var number = numbers[i];
                if (!occurrences[number]) {
                    occurrences[number] = { count: 0, percentage: 0 };
                }
                occurrences[number].count++;
            }

            for (var number in occurrences) {
                occurrences[number].percentage = parseFloat(((occurrences[number].count / numbers.length) * 100).toFixed(2));
            }

            return occurrences;
        }

        //Kesselgucken -> etwas falsch
        function calculateDistances(numbers) {
            var distances = [];
            for (var i = 0; i < numbers.length - 1; i++) {
                var currentNumber = numbers[i];
                var nextNumber = numbers[i + 1];
                var currentIndex = rouletteOrder.indexOf(currentNumber);
                var nextIndex = rouletteOrder.indexOf(nextNumber);
                var distance;
                if (nextIndex >= currentIndex) {
                    distance = nextIndex - currentIndex;
                } else {
                    distance = nextIndex - currentIndex + 37;
                }
                if (!distances[distance]) {
                    distances[distance] = { distance: distance, count: 0, percentage: 0 };
                }
                distances[distance].count++;
            }

            var totalDistances = numbers.length - 1;
            for (var i = 0; i < distances.length; i++) {
                if (distances[i]) {
                    distances[i].percentage = parseFloat(((distances[i].count / totalDistances) * 100).toFixed(2));
                }
            }

            return distances;
        }

        function erstellenTabelle(numbersArray) {
            var probabilities = calculateProbabilities(numbersArray);
            var occurrences = countOccurrences(numbersArray);
            var distances = calculateDistances(numbersArray);

            // Tabelle aufbauen
            var tBody = $('#meineTabelle tbody');
            $.each(distances, function (index, value) {
                var row = `<tr>
                                <td>${value.distance}</td>
                                <td class="hidden">${value.count}</td>
                                <td>${value.percentage}%</td>
                            </tr>`;
                tBody.append(row);
            });

            var tBody2 = $('#meineTabelle2 tbody');
            $.each(occurrences, function (index, value) {
                var row = `<tr>
                                <td>${index}</td>
                                <td class="hidden">${value.count}</td>
                                <td>${value.percentage}%</td>
                            </tr>`;
                tBody2.append(row);
            });
        }
        

        //Menu Checkboxen logik
        document.addEventListener('DOMContentLoaded', (event) => {
            let checkboxes = document.querySelectorAll('input[type="checkbox"]');

            checkboxes.forEach(checkbox => {
                let isChecked = localStorage.getItem(checkbox.id) === 'true';
                checkbox.checked = isChecked;
                let div = document.getElementById('div' + checkbox.id.replace('checkbox', ''));
                div.style.display = isChecked ? 'block' : 'none';
                checkbox.addEventListener('change', function () {
                    let div = document.getElementById('div' + this.id.replace('checkbox', ''));
                    div.style.display = this.checked ? 'block' : 'none';
                    localStorage.setItem(this.id, this.checked);
                });
            });
        });
    </script>
</body>

</html>