<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KesselLutschi</title>
<style>
  body {
    font-family: Arial, sans-serif;
  }

  .title {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 20px;
  }

  .number-input {
    width: calc(100% - 40px);
    padding: 10px;
    font-size: 18px;
    margin: 0 auto;
    display: block;
    box-sizing: border-box;
  }

  .button-container {
    text-align: center;
    margin-top: 10px;
  }

  .confirm-button,
  .download-button,
  .load-button {
    padding: 10px 20px;
    font-size: 18px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-right: 10px;
  }

  .confirm-button {
    background-color: #4CAF50;
    color: white;
  }

  .download-button {
    background-color: #008CBA;
    color: white;
  }

  .load-button {
    background-color: #f44336;
    color: white;
  }

  body {
    font-family: Arial, sans-serif;
  }


  .title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
  }

 

  .label-container {
    display: flex;
    justify-content: space-between;
    width: 100%;
    padding: 0 5px; /* Equal spacing */
    max-width: 65%;
    margin: 0 auto;
    background-color: green;
    border-radius: 15px;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .label {
    flex: 1;
    text-align: center;
  }
  

</style>
</head>
<body>

<div class="title">KesselLutschi</div>
<textarea id="number-input" class="number-input" rows="5" placeholder="Enter numbers separated by spaces"></textarea>
<div class="button-container">
  <button id="confirm-button" class="confirm-button">Save</button>
  <button id="download-button" class="download-button">Download</button>
  <button id="load-button" class="load-button">Load JSON File</button>
  <input type="file" id="file-input" style="display: none;">
</div>
<br>

<!-- Insert provided HTML code here -->
<div id="main-container"></div>

<script>
  // Define the number of iterations
  const iterations = 37;

  // Define the roulette order
  // Get the main container
  const mainContainer = document.getElementById('main-container');

  // Loop to create the structure dynamically
  for (let i = 0; i < iterations; i++) {
    // Create div container
   
    

    // Create label container
    const labelContainer = document.createElement('div');
    labelContainer.classList.add('label-container');

    // Create labels
    for (let j = 0; j < 4; j++) {
      const label = document.createElement('label');
      label.textContent = ``;
      label.classList.add('label', j % 2 === 0 ? 'left' : 'right');
      labelContainer.appendChild(label);
    }

    // Append label container to div container
  

    // Append div container to main container
    mainContainer.appendChild(labelContainer);
  }

  // Function to calculate neighbors
  function calculateNeighbors(numbersArray) {
    const neighbors = {};
    let bool = true;
    let A = [];
    let B = [];
    let Neighbors = 0;
    for (let i = 0; i < numbersArray.length-1; i++) {
        const number = numbersArray[i + 1];
        const prevnumber = numbersArray[i];
        console.log("Number:", number);
        console.log("Previous Number:", prevnumber);
        const rouletteOrder = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        let nextNumberIndex = rouletteOrder.indexOf(parseInt(number));
        let prevNumberIndex = rouletteOrder.indexOf(parseInt(prevnumber));
        console.log("Position of next number:", nextNumberIndex);
        console.log("Position of previous number:", prevNumberIndex);
        if (prevnumber === 'f') {
            bool = true;
        } if (prevnumber === 'b') {
            bool = false;
        }
        if (bool &&  prevnumber !== 'x' && prevnumber !== 'f' && prevnumber !== 'b' && number !== 'x' && number !== 'f' && number !== 'b') {
        let f = 0;
        if(nextNumberIndex - prevNumberIndex > 0) { f = nextNumberIndex - prevNumberIndex }
        if(nextNumberIndex - prevNumberIndex < 0) { f = 37 + (nextNumberIndex - prevNumberIndex)}
            A.push(f);
            console.log("Gezählte Nachbarn F:",f );
        } 
        if (!bool && prevnumber !== 'x' && prevnumber !== 'f' && prevnumber !== 'b' && number !== 'x' && number !== 'f' && number !== 'b') {
            let b = 0;
        if(nextNumberIndex - prevNumberIndex > 0) { b = nextNumberIndex - prevNumberIndex }
        if(nextNumberIndex - prevNumberIndex < 0) { b = 37 + (nextNumberIndex - prevNumberIndex)}
            
            B.push(b);
            console.log("Gezählte Nachbarn B:",b );

        }
        
    }
    console.log("Array A:", A);
    console.log("Array B:", B);
    return [A, B];
}


  document.getElementById('confirm-button').addEventListener('click', function() {
    const numbersInput = document.getElementById('number-input').value.trim();
    
      // Extract numbers and remove non-numeric characters
      const numbersArray = numbersInput.split(/[ ,\n]+/).filter(num => !isNaN(num) || num === 'x' || num === 'f' || num === 'b');

      console.log(numbersArray);
      //const neighbors = calculateNeighbors(numbersArray);
      const [A, B] = calculateNeighbors(numbersArray);
      
        console.log(A);
        console.log(B);

        const sortedA = calculatePercentage(A);
        const sortedB = calculatePercentage(B);

        console.log("Sorted Array A:", sortedA);
        console.log("Sorted Array B:", sortedB);
       

        function calculatePercentage(array) {
    const percentages = {};
    const length = array.length;

    // Count occurrences of each number
    array.forEach(number => {
        percentages[number] = (percentages[number] || 0) + (1 / length * 100);
    });

    // Convert to an array of objects with count, number, and percentage
    const sortedPercentages = Object.entries(percentages).sort((a, b) => b[1] - a[1]);
    const result = sortedPercentages.map(entry => {
        return {
            count: entry[1] / 100 * length, // Calculate count
            number: parseInt(entry[0]), // Convert number to integer
            percentage: entry[1] // Keep percentage
        };
    });

    return result;
}

        // Calculate percentages and sort arrays A and B
        for (let i = 1; i <= 37; i++) {
    // Text innerhalb von Label 1 (Label 1)
    const AElement = sortedA[i - 1] || { count: "", number: "", percentage: "" }; // Indexing starts from 0, so the first element is at index 0

    // Accessing properties of the element
    const cA = AElement.count !== null && AElement.count !== undefined && AElement.count !== "" ? Math.round(AElement.count) : "";
    const nA = AElement.number !== null && AElement.number !== undefined ? AElement.number.toString() : "";
    const pA = AElement.percentage !== null && AElement.percentage !== undefined && !isNaN(parseFloat(AElement.percentage)) ? parseFloat(AElement.percentage).toFixed(3) : ""; // Round to 3 decimal places if it's a valid number

    const BElement = sortedB[i - 1] || { count: "", number: "", percentage: "" }; // Indexing starts from 0, so the first element is at index 0

    // Accessing properties of the element
    const cB = BElement.count !== null && BElement.count !== undefined && BElement.count !== "" ? Math.round(BElement.count) : "";
    const nB = BElement.number !== null && BElement.number !== undefined ? BElement.number.toString() : "";
    const pB = BElement.percentage !== null && BElement.percentage !== undefined && !isNaN(parseFloat(BElement.percentage)) ? parseFloat(BElement.percentage).toFixed(3) : ""; // Round to 3 decimal places if it's a valid number

    // Additional text for percentage
    const percentageTextA = pA ? " (" + pA + "%)" : "";
    const percentageTextB = pB ? " (" + pB + "%)" : "";

    // Text innerhalb von Label 1 (Label 1)
    document.querySelector(`.label-container:nth-child(${i}) label:nth-child(1)`).textContent = nA;
    // Text innerhalb von Label 2 (Label 2)
    document.querySelector(`.label-container:nth-child(${i}) label:nth-child(2)`).textContent = cA + percentageTextA;
    // Text innerhalb von Label 3 (Label 3)
    document.querySelector(`.label-container:nth-child(${i}) label:nth-child(3)`).textContent = nB;
    // Text innerhalb von Label 4 (Label 4)
    document.querySelector(`.label-container:nth-child(${i}) label:nth-child(4)`).textContent = cB + percentageTextB;
}

    
      
  });

  document.getElementById('download-button').addEventListener('click', function() {
    const jsonData = localStorage.getItem('numbers'); // Retrieve the JSON data from localStorage
    if (jsonData) {
      const blob = new Blob([jsonData], { type: 'application/json' }); // Create a Blob with the JSON data
      const a = document.createElement('a');
      a.href = window.URL.createObjectURL(blob);
      a.download = 'numbers.json'; // Set the download attribute to download as numbers.json
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    } else {
      alert('No numbers saved.');
    }
  });

  document.getElementById('load-button').addEventListener('click', function() {
    document.getElementById('file-input').click();
  });

  document.getElementById('file-input').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      const content = e.target.result;
      try {
        const parsedData = JSON.parse(content);
        if (parsedData && parsedData.numbers && Array.isArray(parsedData.numbers)) {
          document.getElementById('number-input').value = parsedData.numbers.join(' ');
        } else {
          alert('Invalid JSON format. Please select a valid JSON file.');
        }
      } catch (error) {
        alert('Error parsing JSON. Please select a valid JSON file.');
      }
    };
    reader.readAsText(file);
  });
</script>

</body>
</html>
